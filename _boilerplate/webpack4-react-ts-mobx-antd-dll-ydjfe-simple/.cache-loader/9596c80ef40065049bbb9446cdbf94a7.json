{"remainingRequest":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\thread-loader\\dist\\cjs.js??ref--7-1!E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\babel-loader\\lib\\index.js??ref--7-2!E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\src\\services\\websocket\\websocket.ts","dependencies":[{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\src\\services\\websocket\\websocket.ts","mtime":1557549177000},{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558612017300},{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1550204147052},{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\babel-loader\\lib\\index.js","mtime":1557710044686}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJhbnRkL2xpYi9tZXNzYWdlL3N0eWxlIjsKaW1wb3J0IF9tZXNzYWdlIGZyb20gImFudGQvbGliL21lc3NhZ2UiOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSAodHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsIDogcmVxdWlyZSgncmVhY3QtaG90LWxvYWRlcicpKS5lbnRlck1vZHVsZTsKICBlbnRlck1vZHVsZSAmJiBlbnRlck1vZHVsZShtb2R1bGUpOwp9KSgpOwoKZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gInN5bWJvbCIpIHsgX3R5cGVvZiA9IGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9OyB9IGVsc2UgeyBfdHlwZW9mID0gZnVuY3Rpb24gX3R5cGVvZihvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajsgfTsgfSByZXR1cm4gX3R5cGVvZihvYmopOyB9CgpmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOyB9IH0KCmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTsgfSB9CgpmdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7IGlmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfQoKZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkgeyBpZiAoY2FsbCAmJiAoX3R5cGVvZihjYWxsKSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7IHJldHVybiBjYWxsOyB9IHJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpOyB9CgpmdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHsgaWYgKHNlbGYgPT09IHZvaWQgMCkgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpOyB9IHJldHVybiBzZWxmOyB9CgpmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyBfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2YobykgeyByZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pOyB9OyByZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pOyB9CgpmdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsgaWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTsgfSBzdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7IGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpOyB9CgpmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkgeyBfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHsgby5fX3Byb3RvX18gPSBwOyByZXR1cm4gbzsgfTsgcmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTsgfQoKaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRlbWl0dGVyMyc7CmltcG9ydCB7IHJlYWN0aW9uIH0gZnJvbSAnbW9ieCc7CmltcG9ydCB7IHNvY2tldFN0b3JlIH0gZnJvbSAnQHN0b3JlL2luZGV4JzsKdmFyIHJlb3BlblRpbWVyID0gbnVsbDsgLy8g5piv5ZCm5Li75Yqo5pat5byACgp2YXIgZGlzY29ubmVjdEluaXRpYXRpdmUgPSBmYWxzZTsKCi8qKgogKiBzb2NrZXQg6YCa5L+hCiAqCiAqIEBleHBvcnQKICogQGNsYXNzIFNvY2tldAogKi8KdmFyIFNvY2tldCA9Ci8qI19fUFVSRV9fKi8KZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoU29ja2V0LCBfRXZlbnRFbWl0dGVyKTsKCiAgZnVuY3Rpb24gU29ja2V0KCkgewogICAgdmFyIF90aGlzOwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBTb2NrZXQpOwoKICAgIF90aGlzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX2dldFByb3RvdHlwZU9mKFNvY2tldCkuY2FsbCh0aGlzKSk7CiAgICBfdGhpcy5vbm9wZW4gPSB2b2lkIDA7CiAgICBfdGhpcy5vbm1lc3NhZ2UgPSB2b2lkIDA7CiAgICBfdGhpcy5jb25uID0gbnVsbDsKCiAgICBfdGhpcy5ydW4oKTsKCiAgICByZXR1cm4gX3RoaXM7CiAgfQoKICBfY3JlYXRlQ2xhc3MoU29ja2V0LCBbewogICAga2V5OiAicnVuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBydW4oKSB7CiAgICAgIHRoaXMub25vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0ZXh0ID0gJ3NvY2tldCBjb25uZWN0ZWQgISEhJzsKICAgICAgICBzb2NrZXRTdG9yZS5zZXRTb2NrZXRJc0Nvbm5lY3RlZCh0cnVlKTsKICAgICAgICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgICAgICAgIGV2ZW50OiAnY29ubmVjdCcsCiAgICAgICAgICBmcm9tOiAnY29uc29sZScsCiAgICAgICAgICBkYXRhOiB0ZXh0CiAgICAgICAgfSk7CiAgICAgIH07CgogICAgICB0aGlzLm9ubWVzc2FnZSA9IGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICBpZiAoIW1zZyB8fCAhbXNnLmRhdGEpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHNvY2tldFN0b3JlLmFkZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICdtZXNzYWdlJywKICAgICAgICAgIGZyb206ICdzZXJ2ZXInLAogICAgICAgICAgZGF0YTogX3R5cGVvZihtc2cuZGF0YSkgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkobXNnLmRhdGEpIDogbXNnLmRhdGEKICAgICAgICB9KTsKICAgICAgfTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kKGRhdGEpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgcmV0cnkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDA7CgogICAgICBpZiAodGhpcy5jb25uICYmIHRoaXMuY29ubi5yZWFkeVN0YXRlID09PSB0aGlzLmNvbm4uT1BFTikgewogICAgICAgIHRoaXMuY29ubi5zZW5kKF90eXBlb2YoZGF0YSkgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkoZGF0YSkgOiBkYXRhKTsKICAgICAgfSBlbHNlIGlmIChyZXRyeSA8IDMpIHsKICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzMi5zZW5kKGRhdGEsIHJldHJ5KyspOwogICAgICAgIH0sIDMwMCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJvcGVuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVuKHVybCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuY29ubiA9IG5ldyBXZWJTb2NrZXQodXJsKTsKCiAgICAgIHRoaXMuY29ubi5vbmNsb3NlID0gZnVuY3Rpb24gKGV2dCkgewogICAgICAgIHNvY2tldFN0b3JlLnNldFNvY2tldElzQ29ubmVjdGVkKGZhbHNlKTsKICAgICAgICB2YXIgdGV4dCA9ICJzb2NrZXQgY2xvc2U6ICIuY29uY2F0KF90eXBlb2YoZXZ0KSA9PT0gJ29iamVjdCcgPyBldnQuY29kZSA6ICcnKTsKICAgICAgICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgICAgICAgIGV2ZW50OiAnY2xvc2UnLAogICAgICAgICAgZnJvbTogJ2NvbnNvbGUnLAogICAgICAgICAgZGF0YTogdGV4dAogICAgICAgIH0pOwogICAgICAgIGNsZWFyVGltZW91dChyZW9wZW5UaW1lcik7CgogICAgICAgIGlmICghZGlzY29ubmVjdEluaXRpYXRpdmUpIHsKICAgICAgICAgIHJlb3BlblRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczMub3Blbih1cmwpOwogICAgICAgICAgfSwgMzAwMCk7CiAgICAgICAgfQoKICAgICAgICBkaXNjb25uZWN0SW5pdGlhdGl2ZSA9IGZhbHNlOwogICAgICB9OwoKICAgICAgdGhpcy5jb25uLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXZ0KSB7CiAgICAgICAgc29ja2V0U3RvcmUuc2V0U29ja2V0SXNDb25uZWN0ZWQoZmFsc2UpOwogICAgICAgIHZhciB0ZXh0ID0gInNvY2tldCBlcnJvcjogIi5jb25jYXQoX3R5cGVvZihldnQpID09PSAnb2JqZWN0JyA/IEpTT04uc3RyaW5naWZ5KGV2dC5jb2RlKSA6ICcnKTsKICAgICAgICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgICAgICAgIGV2ZW50OiAnZXJyb3InLAogICAgICAgICAgZnJvbTogJ2NvbnNvbGUnLAogICAgICAgICAgZGF0YTogdGV4dAogICAgICAgIH0pOwogICAgICB9OwoKICAgICAgcmVhY3Rpb24oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBzb2NrZXRTdG9yZS5zb2NrZXRUeXBlOwogICAgICB9LCBmdW5jdGlvbiAoXywgcikgewogICAgICAgIGNsZWFyVGltZW91dChyZW9wZW5UaW1lcik7CiAgICAgICAgci5kaXNwb3NlKCk7CiAgICAgIH0pOwoKICAgICAgaWYgKHRoaXMub25vcGVuKSB7CiAgICAgICAgdGhpcy5jb25uLm9ub3BlbiA9IHRoaXMub25vcGVuOwogICAgICB9CgogICAgICBpZiAodGhpcy5vbm1lc3NhZ2UpIHsKICAgICAgICB0aGlzLmNvbm4ub25tZXNzYWdlID0gdGhpcy5vbm1lc3NhZ2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogIH0sIHsKICAgIGtleTogIl9fcmVhY3RzdGFuZGluX19yZWdlbmVyYXRlQnlFdmFsIiwKICAgIC8vIEB0cy1pZ25vcmUKICAgIHZhbHVlOiBmdW5jdGlvbiBfX3JlYWN0c3RhbmRpbl9fcmVnZW5lcmF0ZUJ5RXZhbChrZXksIGNvZGUpIHsKICAgICAgLy8gQHRzLWlnbm9yZQogICAgICB0aGlzW2tleV0gPSBldmFsKGNvZGUpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFNvY2tldDsKfShFdmVudEVtaXR0ZXIpOwoKdmFyIHNvY2tldEluc3RhbmNlID0gbmV3IFNvY2tldCgpOwoKZnVuY3Rpb24gY2FuU29ja2V0T3BlbigpIHsKICByZXR1cm4gIShzb2NrZXRJbnN0YW5jZS5jb25uICYmIHNvY2tldEluc3RhbmNlLmNvbm4ucmVhZHlTdGF0ZSA9PT0gc29ja2V0SW5zdGFuY2UuY29ubi5PUEVOKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIHNvY2tldENvbm5lY3QodXJsKSB7CiAgaWYgKCFjYW5Tb2NrZXRPcGVuKCkpIHsKICAgIHJldHVybiBfbWVzc2FnZS5lcnJvcignUGxlYXNlIGRpc2Nvbm5lY3QgdGhlIGV4aXN0aW5nIGluc3RhbmNlISEhJyk7CiAgfQoKICBzb2NrZXRJbnN0YW5jZS5vcGVuKHVybCk7Cn0KZXhwb3J0IGZ1bmN0aW9uIHNvY2tldERpc2Nvbm5lY3QoKSB7CiAgaWYgKHNvY2tldEluc3RhbmNlLmNvbm4gJiYgc29ja2V0SW5zdGFuY2UuY29ubi5yZWFkeVN0YXRlID09PSBzb2NrZXRJbnN0YW5jZS5jb25uLk9QRU4pIHsKICAgIHNvY2tldEluc3RhbmNlLmNvbm4uY2xvc2UoKTsKICB9CgogIGRpc2Nvbm5lY3RJbml0aWF0aXZlID0gdHJ1ZTsKfQpleHBvcnQgZnVuY3Rpb24gc2VuZChfLCBkYXRhKSB7CiAgaWYgKCFzb2NrZXRJbnN0YW5jZS5jb25uICYmIHNvY2tldEluc3RhbmNlLmNvbm4ucmVhZHlTdGF0ZSAhPT0gc29ja2V0SW5zdGFuY2UuY29ubi5PUEVOKSB7CiAgICByZXR1cm4gX21lc3NhZ2UuZXJyb3IoJ1BsZWFzZSBjb25uZWN0IHRvIHNlcnZlciEhIScpOwogIH0KCiAgc29ja2V0SW5zdGFuY2Uuc2VuZChkYXRhKTsKICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgIGV2ZW50OiBudWxsLAogICAgZnJvbTogJ2Jyb3dzZXInLAogICAgZGF0YTogZGF0YQogIH0pOwp9CjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIHJlYWN0SG90TG9hZGVyID0gKHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbCA6IHJlcXVpcmUoJ3JlYWN0LWhvdC1sb2FkZXInKSkuZGVmYXVsdDsKCiAgaWYgKCFyZWFjdEhvdExvYWRlcikgewogICAgcmV0dXJuOwogIH0KCiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIocmVvcGVuVGltZXIsICJyZW9wZW5UaW1lciIsICJFOlxcd29ya3NwYWNlLW15c2VsZlxcbmF0dXJhbC1jbGktdHlwZXNjcmlwdFxcd2VicGFjazQtcmVhY3QtdHMtbW9ieC1hbnRkLXlkamZlXFxzcmNcXHNlcnZpY2VzXFx3ZWJzb2NrZXRcXHdlYnNvY2tldC50cyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGRpc2Nvbm5lY3RJbml0aWF0aXZlLCAiZGlzY29ubmVjdEluaXRpYXRpdmUiLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFx3ZWJzb2NrZXQudHMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihTb2NrZXQsICJTb2NrZXQiLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFx3ZWJzb2NrZXQudHMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihzb2NrZXRJbnN0YW5jZSwgInNvY2tldEluc3RhbmNlIiwgIkU6XFx3b3Jrc3BhY2UtbXlzZWxmXFxuYXR1cmFsLWNsaS10eXBlc2NyaXB0XFx3ZWJwYWNrNC1yZWFjdC10cy1tb2J4LWFudGQteWRqZmVcXHNyY1xcc2VydmljZXNcXHdlYnNvY2tldFxcd2Vic29ja2V0LnRzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoY2FuU29ja2V0T3BlbiwgImNhblNvY2tldE9wZW4iLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFx3ZWJzb2NrZXQudHMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihzb2NrZXRDb25uZWN0LCAic29ja2V0Q29ubmVjdCIsICJFOlxcd29ya3NwYWNlLW15c2VsZlxcbmF0dXJhbC1jbGktdHlwZXNjcmlwdFxcd2VicGFjazQtcmVhY3QtdHMtbW9ieC1hbnRkLXlkamZlXFxzcmNcXHNlcnZpY2VzXFx3ZWJzb2NrZXRcXHdlYnNvY2tldC50cyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHNvY2tldERpc2Nvbm5lY3QsICJzb2NrZXREaXNjb25uZWN0IiwgIkU6XFx3b3Jrc3BhY2UtbXlzZWxmXFxuYXR1cmFsLWNsaS10eXBlc2NyaXB0XFx3ZWJwYWNrNC1yZWFjdC10cy1tb2J4LWFudGQteWRqZmVcXHNyY1xcc2VydmljZXNcXHdlYnNvY2tldFxcd2Vic29ja2V0LnRzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoc2VuZCwgInNlbmQiLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFx3ZWJzb2NrZXQudHMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gKHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbCA6IHJlcXVpcmUoJ3JlYWN0LWhvdC1sb2FkZXInKSkubGVhdmVNb2R1bGU7CiAgbGVhdmVNb2R1bGUgJiYgbGVhdmVNb2R1bGUobW9kdWxlKTsKfSkoKTs="},{"version":3,"sources":["E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\src\\services\\websocket\\websocket.ts"],"names":["EventEmitter","reaction","socketStore","reopenTimer","disconnectInitiative","Socket","onopen","onmessage","conn","run","text","setSocketIsConnected","addMessage","event","from","data","msg","JSON","stringify","retry","readyState","OPEN","send","setTimeout","url","WebSocket","onclose","evt","code","clearTimeout","window","open","onerror","socketType","_","r","dispose","socketInstance","canSocketOpen","socketConnect","error","socketDisconnect","close"],"mappings":"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","sourcesContent":["import { EventEmitter } from 'eventemitter3'\nimport { message } from 'antd'\nimport { reaction } from 'mobx'\n\nimport { socketStore } from '@store/index'\n\nlet reopenTimer: number = null\n// 是否主动断开\nlet disconnectInitiative = false\n\ninterface SocketMsg {\n    data: any\n}\n\n/**\n * socket 通信\n *\n * @export\n * @class Socket\n */\nclass Socket extends EventEmitter {\n    onopen: () => void\n    onmessage: (msg: SocketMsg) => void\n    conn: WebSocket = null\n\n    constructor() {\n        super()\n        this.run()\n    }\n\n    run() {\n        this.onopen = () => {\n            const text = 'socket connected !!!'\n            socketStore.setSocketIsConnected(true)\n            socketStore.addMessage({\n                event: 'connect',\n                from: 'console',\n                data: text\n            })\n        }\n\n        this.onmessage = (msg: SocketMsg) => {\n            if (!msg || !msg.data) {\n                return\n            }\n            socketStore.addMessage({\n                event: 'message',\n                from: 'server',\n                data: typeof msg.data === 'object' ? JSON.stringify(msg.data) : msg.data\n            })\n        }\n    }\n\n    send(data: any, retry = 0) {\n        if (this.conn && this.conn.readyState === this.conn.OPEN) {\n            this.conn.send(typeof data === 'object' ? JSON.stringify(data) : data)\n        } else if (retry < 3) {\n            setTimeout(() => {\n                this.send(data, retry++)\n            }, 300)\n        }\n    }\n\n    open(url: string) {\n        this.conn = new WebSocket(url)\n        this.conn.onclose = evt => {\n            socketStore.setSocketIsConnected(false)\n            const text = `socket close: ${typeof evt === 'object' ? evt.code : ''}`\n            socketStore.addMessage({\n                event: 'close',\n                from: 'console',\n                data: text\n            })\n            clearTimeout(reopenTimer)\n            if (!disconnectInitiative) {\n                reopenTimer = window.setTimeout(() => {\n                    this.open(url)\n                }, 3000)\n            }\n            disconnectInitiative = false\n        }\n        this.conn.onerror = evt => {\n            socketStore.setSocketIsConnected(false)\n            const text = `socket error: ${typeof evt === 'object' ? JSON.stringify((evt as any).code) : ''}`\n            socketStore.addMessage({\n                event: 'error',\n                from: 'console',\n                data: text\n            })\n        }\n\n        reaction(\n            () => socketStore.socketType,\n            (_, r) => {\n                clearTimeout(reopenTimer)\n                r.dispose()\n            }\n        )\n\n        if (this.onopen) {\n            this.conn.onopen = this.onopen\n        }\n        if (this.onmessage) {\n            this.conn.onmessage = this.onmessage\n        }\n        return this\n    }\n}\n\nconst socketInstance = new Socket()\n\nfunction canSocketOpen() {\n    return !(socketInstance.conn && socketInstance.conn.readyState === socketInstance.conn.OPEN)\n}\n\nexport function socketConnect(url: string) {\n    if (!canSocketOpen()) {\n        return message.error('Please disconnect the existing instance!!!')\n    }\n    socketInstance.open(url)\n}\n\nexport function socketDisconnect() {\n    if (socketInstance.conn && socketInstance.conn.readyState === socketInstance.conn.OPEN) {\n        socketInstance.conn.close()\n    }\n    disconnectInitiative = true\n}\n\nexport function send(_, data: any) {\n    if (!socketInstance.conn && socketInstance.conn.readyState !== socketInstance.conn.OPEN) {\n        return message.error('Please connect to server!!!')\n    }\n    socketInstance.send(data)\n    socketStore.addMessage({\n        event: null,\n        from: 'browser',\n        data\n    })\n}\n"]}]}