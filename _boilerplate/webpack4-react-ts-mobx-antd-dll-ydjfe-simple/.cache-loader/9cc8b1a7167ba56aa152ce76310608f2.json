{"remainingRequest":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\thread-loader\\dist\\cjs.js??ref--7-1!E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\babel-loader\\lib\\index.js??ref--7-2!E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\src\\services\\websocket\\socketIO.ts","dependencies":[{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\src\\services\\websocket\\socketIO.ts","mtime":1557549177000},{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1558612017300},{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1550204147052},{"path":"E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\node_modules\\babel-loader\\lib\\index.js","mtime":1557710044686}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJhbnRkL2xpYi9tZXNzYWdlL3N0eWxlIjsKaW1wb3J0IF9tZXNzYWdlIGZyb20gImFudGQvbGliL21lc3NhZ2UiOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgZW50ZXJNb2R1bGUgPSAodHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsIDogcmVxdWlyZSgncmVhY3QtaG90LWxvYWRlcicpKS5lbnRlck1vZHVsZTsKICBlbnRlck1vZHVsZSAmJiBlbnRlck1vZHVsZShtb2R1bGUpOwp9KSgpOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTsgfSB9CgpmdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsgdmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTsgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOyBkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7IGlmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfQoKZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH0KCmltcG9ydCBpbyBmcm9tICdzb2NrZXQuaW8tY2xpZW50JzsKaW1wb3J0IHNvY2tldGlvV2lsZGNhcmQgZnJvbSAnc29ja2V0aW8td2lsZGNhcmQnOwppbXBvcnQgeyByZWFjdGlvbiB9IGZyb20gJ21vYngnOwppbXBvcnQgeyBzb2NrZXRTdG9yZSB9IGZyb20gJ0BzdG9yZS9pbmRleCc7CnZhciBwYXRjaCA9IHNvY2tldGlvV2lsZGNhcmQoaW8uTWFuYWdlcik7Ci8qKgogKiBzb2NrZXQg6YCa5L+hCiAqCiAqIEBleHBvcnQKICogQGNsYXNzIFNvY2tldAogKi8KCnZhciBTb2NrZXQgPQovKiNfX1BVUkVfXyovCmZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBTb2NrZXQoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU29ja2V0KTsKCiAgICB0aGlzLnNvY2tldCA9IHZvaWQgMDsKICB9CgogIF9jcmVhdGVDbGFzcyhTb2NrZXQsIFt7CiAgICBrZXk6ICJzZW5kIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZW5kKGV2ZW50LCBkYXRhKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgcmV0cnkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDA7CgogICAgICBpZiAodGhpcy5zb2NrZXQgJiYgdGhpcy5zb2NrZXQuY29ubmVjdGVkKSB7CiAgICAgICAgdGhpcy5zb2NrZXQuZW1pdChldmVudCwgZGF0YSk7CiAgICAgIH0gZWxzZSBpZiAocmV0cnkgPCAzKSB7CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBfdGhpcy5zZW5kKGRhdGEsIHJldHJ5KyspOwogICAgICAgIH0sIDMwMCk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJvcGVuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBvcGVuKHVybCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciB0cmFuc3BvcnRzID0gWyd3ZWJzb2NrZXQnXTsKCiAgICAgIGlmICghc29ja2V0U3RvcmUubm90U3VwcG9ydFBvbGxpbmcpIHsKICAgICAgICB0cmFuc3BvcnRzLnVuc2hpZnQoJ3BvbGxpbmcnKTsKICAgICAgfQoKICAgICAgdGhpcy5zb2NrZXQgPSBpby5jb25uZWN0KHVybCwgewogICAgICAgIHJlY29ubmVjdGlvbkRlbGF5OiAxMDAwLAogICAgICAgIHJlY29ubmVjdGlvbjogdHJ1ZSwKICAgICAgICByZWNvbm5lY3Rpb25BdHRlbXB0czogNSwKICAgICAgICB0cmFuc3BvcnRzOiB0cmFuc3BvcnRzCiAgICAgIH0pOwogICAgICBwYXRjaCh0aGlzLnNvY2tldCk7CiAgICAgIHJlYWN0aW9uKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gc29ja2V0U3RvcmUuc29ja2V0VHlwZTsKICAgICAgfSwgZnVuY3Rpb24gKF8sIHIpIHsKICAgICAgICBfdGhpczIuc29ja2V0LmNsb3NlKCk7CgogICAgICAgIHIuZGlzcG9zZSgpOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24oJ3JlY29ubmVjdCcsIGZ1bmN0aW9uIChhdHRlbXB0TnVtYmVyKSB7CiAgICAgICAgdmFyIHRleHQgPSAic29ja2V0IHJlY29ubmVjdCBhZnRlciBhdHRlbXB0ICIuY29uY2F0KGF0dGVtcHROdW1iZXIsICIgdGltZXMgISEhIik7CiAgICAgICAgc29ja2V0U3RvcmUuYWRkTWVzc2FnZSh7CiAgICAgICAgICBldmVudDogJ3JlY29ubmVjdCcsCiAgICAgICAgICBmcm9tOiAnY29uc29sZScsCiAgICAgICAgICBkYXRhOiB0ZXh0CiAgICAgICAgfSk7CiAgICAgIH0pOyAvLyDooqvmlq3lvIAsIOS4jemHjei/ngoKICAgICAgdGhpcy5zb2NrZXQub24oJ2Rpc2Nvbm5lY3QnLCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgc29ja2V0U3RvcmUuc2V0U29ja2V0SXNDb25uZWN0ZWQoZmFsc2UpOwogICAgICAgIHZhciB0ZXh0ID0gInNvY2tldCBkaXNjb25uZWN0IGJlY2F1c2U6ICIuY29uY2F0KHJlYXNvbiwgIiAhISEiKTsKICAgICAgICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgICAgICAgIGV2ZW50OiAnZGlzY29ubmVjdCcsCiAgICAgICAgICBmcm9tOiAnY29uc29sZScsCiAgICAgICAgICBkYXRhOiB0ZXh0CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICB0aGlzLnNvY2tldC5vbignY29ubmVjdF90aW1lb3V0JywgZnVuY3Rpb24gKHRpbWVvdXQpIHsKICAgICAgICB2YXIgdGV4dCA9ICJzb2NrZXQgY29ubmVjdF90aW1lb3V0OiAiLmNvbmNhdCh0aW1lb3V0LCAiICEhISIpOwogICAgICAgIHNvY2tldFN0b3JlLmFkZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICdjb25uZWN0X3RpbWVvdXQnLAogICAgICAgICAgZnJvbTogJ2NvbnNvbGUnLAogICAgICAgICAgZGF0YTogdGV4dAogICAgICAgIH0pOwogICAgICB9KTsgLy8g6L+e5o6l6ZSZ6K+vCgogICAgICB0aGlzLnNvY2tldC5vbignY29ubmVjdF9lcnJvcicsIGZ1bmN0aW9uIChlcnIpIHsKICAgICAgICB2YXIgdGV4dCA9ICdzb2NrZXQgY29ubmVjdF9lcnJvciAhISEnOwogICAgICAgIHNvY2tldFN0b3JlLmFkZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICdjb25uZWN0X2Vycm9yJywKICAgICAgICAgIGZyb206ICdjb25zb2xlJywKICAgICAgICAgIGRhdGE6IHRleHQKICAgICAgICB9KTsKICAgICAgICBjb25zb2xlLndhcm4oZXJyKTsKICAgICAgfSk7IC8vIOmUmeivr+aNleiOtwoKICAgICAgdGhpcy5zb2NrZXQub24oJ2Vycm9yJywgZnVuY3Rpb24gKGVycikgewogICAgICAgIHNvY2tldFN0b3JlLnNldFNvY2tldElzQ29ubmVjdGVkKGZhbHNlKTsKICAgICAgICB2YXIgdGV4dCA9ICdzb2NrZXQgZXJyb3IgISEhJzsKICAgICAgICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgICAgICAgIGV2ZW50OiAnZXJyb3InLAogICAgICAgICAgZnJvbTogJ2NvbnNvbGUnLAogICAgICAgICAgZGF0YTogdGV4dAogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUud2FybihlcnIpOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgc29ja2V0U3RvcmUuc2V0U29ja2V0SXNDb25uZWN0ZWQodHJ1ZSk7CiAgICAgICAgdmFyIHRleHQgPSAnc29ja2V0IGNvbm5lY3RlZCAhISEnOwogICAgICAgIHNvY2tldFN0b3JlLmFkZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICdjb25uZWN0JywKICAgICAgICAgIGZyb206ICdjb25zb2xlJywKICAgICAgICAgIGRhdGE6IHRleHQKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKCdwaW5nJywgZnVuY3Rpb24gKCkgewogICAgICAgIHNvY2tldFN0b3JlLmFkZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICdwaW5nJywKICAgICAgICAgIGZyb206ICdicm93c2VyJywKICAgICAgICAgIGRhdGE6IG51bGwKICAgICAgICB9KTsKICAgICAgfSk7CiAgICAgIHRoaXMuc29ja2V0Lm9uKCdwb25nJywgZnVuY3Rpb24gKCkgewogICAgICAgIHNvY2tldFN0b3JlLmFkZE1lc3NhZ2UoewogICAgICAgICAgZXZlbnQ6ICdwb25nJywKICAgICAgICAgIGZyb206ICdzZXJ2ZXInLAogICAgICAgICAgZGF0YTogbnVsbAogICAgICAgIH0pOwogICAgICB9KTsKICAgICAgdGhpcy5zb2NrZXQub24oJyonLCBmdW5jdGlvbiAocGtnKSB7CiAgICAgICAgY29uc29sZS5sb2coJ29uIGFsbCBzb2NrZXQgY2FsbGJhY2s6ICcsIHBrZyk7CgogICAgICAgIGlmIChwa2cgJiYgcGtnLmRhdGEgaW5zdGFuY2VvZiBBcnJheSAmJiBwa2cuZGF0YS5sZW5ndGggPiAxKSB7CiAgICAgICAgICB2YXIgZXZlbnQgPSBwa2cuZGF0YVswXTsKICAgICAgICAgIHZhciBkYXRhID0gcGtnLmRhdGFbMV07CiAgICAgICAgICBzb2NrZXRTdG9yZS5hZGRNZXNzYWdlKHsKICAgICAgICAgICAgZXZlbnQ6IGV2ZW50LAogICAgICAgICAgICBmcm9tOiAnc2VydmVyJywKICAgICAgICAgICAgZGF0YTogZGF0YQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJfX3JlYWN0c3RhbmRpbl9fcmVnZW5lcmF0ZUJ5RXZhbCIsCiAgICAvLyBAdHMtaWdub3JlCiAgICB2YWx1ZTogZnVuY3Rpb24gX19yZWFjdHN0YW5kaW5fX3JlZ2VuZXJhdGVCeUV2YWwoa2V5LCBjb2RlKSB7CiAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgdGhpc1trZXldID0gZXZhbChjb2RlKTsKICAgIH0KICB9XSk7CgogIHJldHVybiBTb2NrZXQ7Cn0oKTsKCnZhciBzb2NrZXRJbnN0YW5jZSA9IG5ldyBTb2NrZXQoKTsKCmZ1bmN0aW9uIGNhblNvY2tldE9wZW4oKSB7CiAgcmV0dXJuICEoc29ja2V0SW5zdGFuY2Uuc29ja2V0ICYmIHNvY2tldEluc3RhbmNlLnNvY2tldC5jb25uZWN0ZWQpOwp9CgpleHBvcnQgZnVuY3Rpb24gc29ja2V0Q29ubmVjdCh1cmwpIHsKICBpZiAoIWNhblNvY2tldE9wZW4oKSkgewogICAgcmV0dXJuIF9tZXNzYWdlLmVycm9yKCdQbGVhc2UgZGlzY29ubmVjdCB0aGUgZXhpc3RpbmcgaW5zdGFuY2UhISEnKTsKICB9CgogIHNvY2tldEluc3RhbmNlLm9wZW4odXJsKTsKfQpleHBvcnQgZnVuY3Rpb24gc29ja2V0RGlzY29ubmVjdCgpIHsKICBpZiAoc29ja2V0SW5zdGFuY2Uuc29ja2V0ICYmIHNvY2tldEluc3RhbmNlLnNvY2tldC5jb25uZWN0ZWQpIHsKICAgIHNvY2tldEluc3RhbmNlLnNvY2tldC5jbG9zZSgpOwogIH0KfQpleHBvcnQgZnVuY3Rpb24gc2VuZChldmVudCwgZGF0YSkgewogIGlmICghc29ja2V0SW5zdGFuY2Uuc29ja2V0IHx8ICFzb2NrZXRJbnN0YW5jZS5zb2NrZXQuY29ubmVjdGVkKSB7CiAgICByZXR1cm4gX21lc3NhZ2UuZXJyb3IoJ1BsZWFzZSBjb25uZWN0IHRvIHNlcnZlciEhIScpOwogIH0KCiAgc29ja2V0SW5zdGFuY2Uuc2VuZChldmVudCwgZGF0YSk7CiAgc29ja2V0U3RvcmUuYWRkTWVzc2FnZSh7CiAgICBldmVudDogZXZlbnQsCiAgICBmcm9tOiAnYnJvd3NlcicsCiAgICBkYXRhOiBkYXRhCiAgfSk7Cn0KOwoKKGZ1bmN0aW9uICgpIHsKICB2YXIgcmVhY3RIb3RMb2FkZXIgPSAodHlwZW9mIHJlYWN0SG90TG9hZGVyR2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IHJlYWN0SG90TG9hZGVyR2xvYmFsIDogcmVxdWlyZSgncmVhY3QtaG90LWxvYWRlcicpKS5kZWZhdWx0OwoKICBpZiAoIXJlYWN0SG90TG9hZGVyKSB7CiAgICByZXR1cm47CiAgfQoKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihwYXRjaCwgInBhdGNoIiwgIkU6XFx3b3Jrc3BhY2UtbXlzZWxmXFxuYXR1cmFsLWNsaS10eXBlc2NyaXB0XFx3ZWJwYWNrNC1yZWFjdC10cy1tb2J4LWFudGQteWRqZmVcXHNyY1xcc2VydmljZXNcXHdlYnNvY2tldFxcc29ja2V0SU8udHMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3RlcihTb2NrZXQsICJTb2NrZXQiLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFxzb2NrZXRJTy50cyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHNvY2tldEluc3RhbmNlLCAic29ja2V0SW5zdGFuY2UiLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFxzb2NrZXRJTy50cyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKGNhblNvY2tldE9wZW4sICJjYW5Tb2NrZXRPcGVuIiwgIkU6XFx3b3Jrc3BhY2UtbXlzZWxmXFxuYXR1cmFsLWNsaS10eXBlc2NyaXB0XFx3ZWJwYWNrNC1yZWFjdC10cy1tb2J4LWFudGQteWRqZmVcXHNyY1xcc2VydmljZXNcXHdlYnNvY2tldFxcc29ja2V0SU8udHMiKTsKICByZWFjdEhvdExvYWRlci5yZWdpc3Rlcihzb2NrZXRDb25uZWN0LCAic29ja2V0Q29ubmVjdCIsICJFOlxcd29ya3NwYWNlLW15c2VsZlxcbmF0dXJhbC1jbGktdHlwZXNjcmlwdFxcd2VicGFjazQtcmVhY3QtdHMtbW9ieC1hbnRkLXlkamZlXFxzcmNcXHNlcnZpY2VzXFx3ZWJzb2NrZXRcXHNvY2tldElPLnRzIik7CiAgcmVhY3RIb3RMb2FkZXIucmVnaXN0ZXIoc29ja2V0RGlzY29ubmVjdCwgInNvY2tldERpc2Nvbm5lY3QiLCAiRTpcXHdvcmtzcGFjZS1teXNlbGZcXG5hdHVyYWwtY2xpLXR5cGVzY3JpcHRcXHdlYnBhY2s0LXJlYWN0LXRzLW1vYngtYW50ZC15ZGpmZVxcc3JjXFxzZXJ2aWNlc1xcd2Vic29ja2V0XFxzb2NrZXRJTy50cyIpOwogIHJlYWN0SG90TG9hZGVyLnJlZ2lzdGVyKHNlbmQsICJzZW5kIiwgIkU6XFx3b3Jrc3BhY2UtbXlzZWxmXFxuYXR1cmFsLWNsaS10eXBlc2NyaXB0XFx3ZWJwYWNrNC1yZWFjdC10cy1tb2J4LWFudGQteWRqZmVcXHNyY1xcc2VydmljZXNcXHdlYnNvY2tldFxcc29ja2V0SU8udHMiKTsKfSkoKTsKCjsKCihmdW5jdGlvbiAoKSB7CiAgdmFyIGxlYXZlTW9kdWxlID0gKHR5cGVvZiByZWFjdEhvdExvYWRlckdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyByZWFjdEhvdExvYWRlckdsb2JhbCA6IHJlcXVpcmUoJ3JlYWN0LWhvdC1sb2FkZXInKSkubGVhdmVNb2R1bGU7CiAgbGVhdmVNb2R1bGUgJiYgbGVhdmVNb2R1bGUobW9kdWxlKTsKfSkoKTs="},{"version":3,"sources":["E:\\workspace-myself\\natural-cli-typescript\\webpack4-react-ts-mobx-antd-ydjfe\\src\\services\\websocket\\socketIO.ts"],"names":["io","socketioWildcard","reaction","socketStore","patch","Manager","Socket","socket","event","data","retry","connected","emit","setTimeout","send","url","transports","notSupportPolling","unshift","connect","reconnectionDelay","reconnection","reconnectionAttempts","socketType","_","r","close","dispose","on","attemptNumber","text","addMessage","from","reason","setSocketIsConnected","timeout","err","console","warn","pkg","log","Array","length","socketInstance","canSocketOpen","socketConnect","error","open","socketDisconnect"],"mappings":"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","sourcesContent":["import io from 'socket.io-client'\nimport socketioWildcard from 'socketio-wildcard'\nimport { message } from 'antd'\nimport { reaction } from 'mobx'\n\nimport { socketStore } from '@store/index'\n\nconst patch = socketioWildcard(io.Manager)\n\n/**\n * socket 通信\n *\n * @export\n * @class Socket\n */\nclass Socket {\n    socket: SocketIOClient.Socket\n\n    send(event: string, data: any, retry = 0) {\n        if (this.socket && this.socket.connected) {\n            this.socket.emit(event, data)\n        } else if (retry < 3) {\n            setTimeout(() => {\n                this.send(data, retry++)\n            }, 300)\n        }\n    }\n\n    open(url: string) {\n        const transports = ['websocket']\n        if (!socketStore.notSupportPolling) {\n            transports.unshift('polling')\n        }\n        this.socket = io.connect(url, {\n            reconnectionDelay: 1000,\n            reconnection: true,\n            reconnectionAttempts: 5,\n            transports\n        })\n\n        patch(this.socket)\n\n        reaction(\n            () => socketStore.socketType,\n            (_, r) => {\n                this.socket.close()\n                r.dispose()\n            }\n        )\n\n        this.socket.on('reconnect', attemptNumber => {\n            const text = `socket reconnect after attempt ${attemptNumber} times !!!`\n            socketStore.addMessage({\n                event: 'reconnect',\n                from: 'console',\n                data: text\n            })\n        })\n\n        // 被断开, 不重连\n        this.socket.on('disconnect', reason => {\n            socketStore.setSocketIsConnected(false)\n            const text = `socket disconnect because: ${reason} !!!`\n            socketStore.addMessage({\n                event: 'disconnect',\n                from: 'console',\n                data: text\n            })\n        })\n\n        this.socket.on('connect_timeout', timeout => {\n            const text = `socket connect_timeout: ${timeout} !!!`\n            socketStore.addMessage({\n                event: 'connect_timeout',\n                from: 'console',\n                data: text\n            })\n        })\n\n        // 连接错误\n        this.socket.on('connect_error', err => {\n            const text = 'socket connect_error !!!'\n            socketStore.addMessage({\n                event: 'connect_error',\n                from: 'console',\n                data: text\n            })\n            console.warn(err)\n        })\n\n        // 错误捕获\n        this.socket.on('error', err => {\n            socketStore.setSocketIsConnected(false)\n            const text = 'socket error !!!'\n            socketStore.addMessage({\n                event: 'error',\n                from: 'console',\n                data: text\n            })\n            console.warn(err)\n        })\n\n        this.socket.on('connect', () => {\n            socketStore.setSocketIsConnected(true)\n            const text = 'socket connected !!!'\n            socketStore.addMessage({\n                event: 'connect',\n                from: 'console',\n                data: text\n            })\n        })\n\n        this.socket.on('ping', () => {\n            socketStore.addMessage({\n                event: 'ping',\n                from: 'browser',\n                data: null\n            })\n        })\n\n        this.socket.on('pong', () => {\n            socketStore.addMessage({\n                event: 'pong',\n                from: 'server',\n                data: null\n            })\n        })\n\n        this.socket.on('*', pkg => {\n            console.log('on all socket callback: ', pkg)\n            if (pkg && pkg.data instanceof Array && pkg.data.length > 1) {\n                const event = pkg.data[0]\n                const data = pkg.data[1]\n                socketStore.addMessage({\n                    event,\n                    from: 'server',\n                    data\n                })\n            }\n        })\n    }\n}\n\nconst socketInstance = new Socket()\n\nfunction canSocketOpen() {\n    return !(socketInstance.socket && socketInstance.socket.connected)\n}\n\nexport function socketConnect(url: string) {\n    if (!canSocketOpen()) {\n        return message.error('Please disconnect the existing instance!!!')\n    }\n    socketInstance.open(url)\n}\n\nexport function socketDisconnect() {\n    if (socketInstance.socket && socketInstance.socket.connected) {\n        socketInstance.socket.close()\n    }\n}\n\nexport function send(event: string, data: any) {\n    if (!socketInstance.socket || !socketInstance.socket.connected) {\n        return message.error('Please connect to server!!!')\n    }\n    socketInstance.send(event, data)\n    socketStore.addMessage({\n        event,\n        from: 'browser',\n        data\n    })\n}\n"]}]}